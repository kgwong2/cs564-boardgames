<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="/styles/gameStyles.css">
    <script src="/scripts/gameScript.js" defer></script>
</head>

<body>
    <nav id="navbar">
        <a href="/">Home</a>
        <a href="/search">Search</a>

        <% if (currentUserId) { %>
            <!-- User is logged in -->
            <a class="_userNav" href="/user">My Profile</a>
            <a class="_userNav" href="/logout">Log Out</a>
        <% } else { %>
            <!-- User is not logged in -->
            <a class="_userNav" href="/login">Log In</a>
            <a class="_userNav" href="/signup">Sign Up</a>
        <% } %>
    </nav>
    <!--Game-->
    <div id="<%= gameId %>" class="uniqueTest"></div>
    <div class="_listedGame">
        <table>
            <tr>
                <td id="gameImageId" rowspan="4" class="_gameImg"></td>
                <td id="gameTitleId" colspan="5" class="_gameTitle"></td>
            </tr>
            <tr>
                <td colspan="5" class="_gameInfo">
                    <div id="gamePublishYearId"></div><br>
                    <div id="gameDescriptionId"></div><br>
                </td>
            </tr>
            <tr>
                <td class="_gameInfo _gameMetadata">
                    <div class="_h3">
                        <p id="gameWeightId" class="_inlineBlock"></p>
                        <p class="_inlineBlock"> / 5</p>
                    </div>
                    Complexity<br>
                </td>
                <td class="_gameInfo _gameMetadata">
                    <div class="_h3">
                        <p id="gameMinPlayersId" class="_inlineBlock"></p>
                        <p class="_inlineBlock">-</p>
                        <p id="gameMaxPlayersId" class="_inlineBlock"></p>
                    </div>
                    Players<br>
                </td>
                <td class="_gameInfo _gameMetadata">
                    <div class="_h3">
                        <p id="gameMinPlaytime" class="_inlineBlock"></p>
                        <p class="_inlineBlock">-</p>
                        <p id="gameMaxPlaytime" class="_inlineBlock"></p>
                    </div>
                    Playtime<br>
                </td>
                <td id="gameMetadata4" class="_gameInfo _gameMetadata">
                    <div class="_h3">
                        <p id="gameMinAge" class="_inlineBlock"></p>
                    </div>
                    Age<br>
                </td>
                <td></td>
            </tr>
            <tr>
                <td colspan="5" class="_gameInfo">
                    <div class="_h3">
                        Creators
                    </div>
                    <table class="_creatorTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Designer?</th>
                                <th>Artist?</th>
                            </tr>
                        </thead>
                        <tbody id="creatorList">
                        </tbody>
                    </table>
                </td>
            </tr>
        </table>
    </div>

    <!-- Add Review Button -->
    <button id="showReviewForm">Add Review</button>

    <!-- Hidden Review Form -->
    <form id="addReviewForm" method="POST" action="/review/add/<%= game.id %>" style="display: none;">
        <label for="rating">Rating:</label>
        <input type="number" name="rating" min="1" max="10" required>

        <label for="comment">Comment:</label>
        <textarea name="comment" rows="4" required></textarea>

        <button type="submit">Submit Review</button>
    </form>

    <!--Reviews-->
        <table class="_reviewsTable">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Rating</th>
                    <th>Comment</th>
                </tr>
            </thead>
            <tbody>
                <% if (reviews && reviews.length > 0) { %>
                    <% reviews.forEach(review => { %>
                        <tr>
                            <td><%= review.username %></td>
                            <td><%= review.rating %></td>
                            <td><%= review.comment %></td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <p>No reviews yet for this game.</p>
                <% } %>
            </tbody>
        </table>
</body>

<script>
    document.getElementById("showReviewForm").addEventListener("click", function() {
        const form = document.getElementById("addReviewForm");
        form.style.display = form.style.display === "none" ? "block" : "none";
    });
</script>

</html>