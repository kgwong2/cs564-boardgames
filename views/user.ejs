<!DOCTYPE html>
<html>

<head>
    <title><%= user.username %> - Profile</title>
    <link rel="stylesheet" href="/styles/gameStyles.css">
</head>

<body>
    <!-- Navbar -->
    <nav id="navbar">
        <a href="/">Home</a>
        <a href="/search">Search</a>

        <% if (currentUserId) { %>
            <!-- User is logged in -->
            <a class="_userNav" href="/user">My Profile</a>
            <a class="_userNav" href="/logout">Log Out</a>
        <% } else { %>
            <!-- User is not logged in -->
            <a class="_userNav" href="/login">Log In</a>
            <a class="_userNav" href="/signup">Sign Up</a>
        <% } %>
    </nav>

    <main class="container">
        <!-- User Profile Info Section -->
        <section class="profile-header">
            <div class="profile-info">
                <div>
                    <h1><%= user.username %></h1>
                    <p>User ID: <%= user.userId %></p>
                    <p>Total Reviews: <%= reviews.length %></p>
                </div>
            </div>
        </section>

        <!-- Reviews Table -->
        <table class="reviews-table">
            <thead>
                <tr>
                    <th>Game</th>
                    <th>Image</th>
                    <th>Rating</th>
                    <th>Comment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <% if (reviews.length > 0) { %>
                <% reviews.forEach(function(review) { %>
                <tr>
                    <!-- Game title with link -->
                    <td>
                        <a href="/game/<%= review.boardgameId %>"><%= review.name %></a>
                    </td>
                    <!-- Game Pic -->
                    <td>
                        <img src="<%= review.image %>" alt="<%= review.name %>" class="thumbnail" />
                    </td>
                    <!-- Review rating -->
                    <td><%= review.rating %>/10</td>
                    <!-- Review comment -->
                    <td>"<%= review.comment %>"</td>

                    <!-- Edit/Delete buttons -->
                    <td>
                        <% if (review.userId === currentUserId) { %>
                            <button class="btn-edit" onclick="openEditModal(<%= review.userId %>, <%= review.boardgameId %>, <%= review.rating %>, <%= JSON.stringify(review.comment) %>)">Edit</button>
                            <button class="btn-delete" onclick="openDeleteModal(<%= review.userId %>, <%= review.boardgameId %>)">Delete</button>
                        <% } %>
                    </td>
                </tr>
                    <% }) %>
                    <% } else { %>
                        <!-- If user has no reviews -->
                        <tr>
                            <td colspan="5">You haven't written any reviews yet. Go to home or search and add reviews!</td>
                        </tr>
                    <% } %>
            </tbody>
        </table>
    </main>

    <!-- Edit Modal (Pop-up window) -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h3>Edit Review</h3>
            <form id="editForm" method="POST">
                <label>Rating: </label>
                <input type="number" name="rating" min="1" max="10" required><br><br>
                <label>Comment: </label>
                <textarea name="comment" required></textarea><br><br>
                <button type="submit">Save</button>
                <button type="button" onclick="closeEditModal()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>Delete Review</h3>
            <p>Are you sure you want to delete this review?</p>
            <form id="deleteForm" method="POST">
                <button type="submit">Yes, delete</button>
                <button type="button" onclick="closeDeleteModal()">Cancel</button>
            </form>
        </div>
    </div>

    <script src="/scripts/userPage.js"></script>
</body>
</html>